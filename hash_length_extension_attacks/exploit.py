# -*- coding:utf-8 -*-
# @Time     : 2018/5/10 16:20
# @Author   : XXH
# @Email    : kenvinxxh@gmail.com
# @File     : expliot.py
# @Software : PyCharm

import sys
import md5


if len(sys.argv) < 4:
    # 输入Usage
    print "Usage: expliot.py <md5string> <appendstring> [length of md5string]"
    sys.exit()


if len(sys.argv[1]) != 32:
    print "HASH IS 32B"
    sys.exit()

hash = sys.argv[1] # 上一次的hash值
append = sys.argv[2] # 添加的字符串
length = int(sys.argv[3]) # 已知的secret+string的长度

# 首先进行appending
appendNew = md5.append(append, length)
# 对第二个64位进行md5压缩
md5Result = md5.md5(appendNew[1], hash)


print "\n"
print "               HASH_EXTENSION_ATTACK           "
print "\n" * 2
print "     *       *        * * * *      * * * **   "
print "    * *     * *       *       *    *          "
print "   *   *   *   *      *        *   * * * *    "
print "  *     * *     *     *       *            *  "
print " *       *       *    * * * *      * * * *    "
print "\n" * 2
print "md5String :    ", hash
print "appendString : ", append
print "payload :      ", appendNew[0]+append
print "newMd5String : ", md5Result
print "\n"
print "Thanks to use"
